# ãƒ•ã‚¡ã‚¤ãƒ«å: .github/workflows/deploy.yml

name: Deploy Vite Project to GitHub Pages # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å

on:
  push:
    branches:
      - main # mainãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥ã§å®Ÿè¡Œ
  workflow_dispatch:

# ğŸš€ æ¨©é™è¨­å®šï¼ˆãã®ã¾ã¾ç¶­æŒã—ã¾ã™ã€‚ã“ã‚ŒãŒ exit code 128 ã®è§£æ±ºã«ä¸å¯æ¬ ã§ã™ï¼‰ğŸš€
permissions:
  contents: read
  pages: write # Pagesã¸ã®æ›¸ãè¾¼ã¿æ¨©é™
  id-token: write # ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆèªè¨¼ã«å¿…è¦ãªæ¨©é™

jobs:
  # 1. ãƒ“ãƒ«ãƒ‰ã¨æˆæœç‰©ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’è¡Œã†ã‚¸ãƒ§ãƒ–
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm install

      - name: Build project
        run: npm run build

      # ğŸ’¡ è¿½è¨˜ç®‡æ‰€ 1: ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ ğŸ’¡
      # ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¾ã™
      - name: Upload Artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./dist # ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã®ã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã‚’æŒ‡å®š

  # 2. ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸæˆæœç‰©ã‚’ä½¿ã£ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã†ã‚¸ãƒ§ãƒ–
  deploy:
    # `build`ã‚¸ãƒ§ãƒ–ãŒæˆåŠŸã—ãŸå¾Œã«å®Ÿè¡Œ
    needs: build 
    
    # ğŸ’¡ è¿½è¨˜ç®‡æ‰€ 2: ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆç’°å¢ƒã®è¨­å®š ğŸ’¡
    # GitHub Pagesã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    runs-on: ubuntu-latest
    steps:
      # ğŸ’¡ è¿½è¨˜ç®‡æ‰€ 3: å…¬å¼ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ ğŸ’¡
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4 # GitHubå…¬å¼ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨